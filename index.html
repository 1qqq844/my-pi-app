<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi 战区：红色警戒</title>
    
    <meta name="pi-sdk-version" content="2.0">
    <link rel="canonical" href="https://1qqq844.github.io/my-pi-app/">

    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    
    <style>
        body { font-family: 'Courier New', Courier, monospace; background-color: #000; color: #0f0; text-align: center; padding-top: 50px; }
        .terminal { border: 2px solid #0f0; background: #050505; margin: 20px auto; padding: 20px; width: 85%; max-width: 500px; box-shadow: 0 0 15px #0f0; }
        .status-on { color: #0f0; font-weight: bold; }
        .status-off { color: #f00; font-weight: bold; }
        button { background: #0f0; color: #000; border: none; padding: 15px 30px; font-size: 16px; font-weight: bold; cursor: pointer; margin: 10px; }
        button:active { background: #0a0; }
        .log { font-size: 12px; color: #888; margin-top: 20px; text-align: left; height: 100px; overflow-y: scroll; border-top: 1px solid #333; padding-top: 10px; }
    </style>
</head>
<body>

    <div class="terminal">
        <h1>COMMAND CENTER v1.0</h1>
        <p>系统状态: <span id="sdk-status" class="status-off">未连接</span></p>
        <hr>
        <div id="auth-section">
            <p>指挥官: 未验证身份</p>
            <button onclick="login()">初始化身份识别</button>
        </div>
        <div class="log" id="sys-log">正在等待指令...</div>
    </div>

    <script>
        const Pi = window.Pi;
        const logBox = document.getElementById('sys-log');

        function writeLog(msg) {
            logBox.innerHTML += `> ${msg}<br>`;
            logBox.scrollTop = logBox.scrollHeight;
        }

        // 1. 初始化 SDK
        try {
            writeLog("开始初始化 Pi SDK...");
            Pi.init({ version: "2.0", sandbox: false });
            document.getElementById('sdk-status').innerText = "正常运行";
            document.getElementById('sdk-status').className = "status-on";
            writeLog("SDK 初始化成功。");
        } catch (err) {
            writeLog("SDK 启动失败，请检查环境。");
        }

        // 2. 身份验证函数
        async function login() {
            writeLog("正在扫描生物特征 (Pi Authenticate)...");
            try {
                // 必须申请 payments 权限以便后续购买资源
                const scopes = ['username', 'payments'];
                const user = await Pi.authenticate(scopes, onIncompletePaymentFound);
                
                document.getElementById('auth-section').innerHTML = `
                    <p>指挥官: <span class="status-on">${user.user.username}</span></p>
                    <p class="status-on">身份已确认，基地准备就绪。</p>
                `;
                writeLog(`身份认证成功: ${user.user.username}`);
            } catch (err) {
                writeLog(`认证失败: ${err.message}`);
                alert("认证失败，请确保在 Pi Browser 中运行。");
            }
        }

        function onIncompletePaymentFound(payment) {
            writeLog("系统发现未完成的交易记录。");
        };
    </script>
</body>
</html>

