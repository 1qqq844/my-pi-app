
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éº¦éœ¸é¢åŒ…åº— - Pi æµ‹è¯•</title>
    
    <meta name="pi-sdk-version" content="2.0">
    <link rel="canonical" href="https://1qqq844.github.io/my-pi-app/">

    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    
    <style>
        body { font-family: sans-serif; text-align: center; padding-top: 50px; background-color: #f4f4f9; }
        .card { background: white; margin: 20px auto; padding: 20px; width: 85%; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border: 1px solid #ddd; }
        h1 { color: #673ab7; }
        #user-display { color: #2e7d32; font-weight: bold; margin: 10px 0; }
        button { width: 80%; padding: 15px; font-size: 18px; cursor: pointer; background: #673ab7; color: white; border: none; border-radius: 8px; margin: 10px 0; font-weight: bold; }
        button:active { background: #512da8; transform: scale(0.98); }
        .status { color: #666; font-size: 12px; margin-top: 30px; background: #eee; padding: 10px; }
    </style>
</head>
<body>

    <div class="card">
        <h1>éº¦éœ¸é¢åŒ…åº— ğŸ¥</h1>
        <div id="user-display">æœªç™»å½•çŠ¶æ€</div>
        <button onclick="login()">1. ç‚¹å‡»ç™»å½•å¹¶æˆæƒ</button>
    </div>

    <div class="card">
        <h3>ä»Šæ—¥ä¸‹å•</h3>
        <p>æ‰‹å·¥å¥¶æ²¹é¢åŒ…ï¼š0.1 Test-Pi</p>
        <button onclick="transferPi()" style="background: #ef6c00;">2. å‘èµ·æ”¯ä»˜</button>
    </div>

    <div id="status-box" class="status">SDK çŠ¶æ€: æ­£åœ¨åˆå§‹åŒ–...</div>

    <script>
        const Pi = window.Pi;

        // åˆå§‹åŒ– SDK
        try {
            // åœ¨ Pi Browser çœŸå®ç¯å¢ƒæµ‹è¯•ï¼Œsandbox è®¾ä¸º false
            Pi.init({ version: "2.0", sandbox: false });
            document.getElementById('status-box').innerText = "SDK çŠ¶æ€: åˆå§‹åŒ–æˆåŠŸ";
        } catch (err) {
            document.getElementById('status-box').innerText = "SDK çŠ¶æ€: åˆå§‹åŒ–å¤±è´¥";
        }

        // ç™»å½•ä¸æˆæƒå‡½æ•°
        async function login() {
            alert("æ­£åœ¨å‡†å¤‡è°ƒèµ·å®˜æ–¹æˆæƒçª—å£..."); 
            try {
                // å¿…é¡»åŒ…å« 'payments' æƒé™æ‰èƒ½åœ¨åç»­è°ƒèµ·é’±åŒ…
                const scopes = ['username', 'payments']; 
                const user = await Pi.authenticate(scopes, onIncompletePaymentFound);
                
                // æˆåŠŸæˆæƒåæ˜¾ç¤ºç”¨æˆ·å
                document.getElementById('user-display').innerText = "æ¬¢è¿å›æ¥: " + user.user.username;
                alert("æˆæƒæˆåŠŸï¼æ‚¨ç°åœ¨å¯ä»¥ç‚¹å‡»ä¸‹æ–¹æ”¯ä»˜æŒ‰é’®äº†ã€‚");
            } catch (err) {
                alert("æˆæƒå¤±è´¥åŸå› : " + err.message);
            }
        }

        // å‘èµ·æ”¯ä»˜å‡½æ•°
        async function transferPi() {
            try {
                const paymentData = {
                    amount: 0.1,
                    memo: "è´­ä¹°éº¦éœ¸æ‰‹å·¥é¢åŒ…",
                    metadata: { orderId: "Bread-" + Math.floor(Date.now() / 1000) }
                };

                const callbacks = {
                    onReadyForServerApproval: (paymentId) => {
                        alert("è®¢å•å·²åˆ›å»ºï¼ç­‰å¾…æœåŠ¡å™¨æ‰¹å‡†ã€‚ID: " + paymentId);
                    },
                    onReadyForServerCompletion: (paymentId, txid) => {
                        alert("æ”¯ä»˜æˆåŠŸï¼æ„Ÿè°¢è´­ä¹°ã€‚äº¤æ˜“å“ˆå¸Œ: " + txid);
                    },
                    onCancel: (paymentId) => { console.log("æ”¯ä»˜å–æ¶ˆ"); },
                    onError: (error, payment) => { alert("æ”¯ä»˜é”™è¯¯: " + error.message); }
                };

                alert("å‡†å¤‡æ‹‰èµ·å®˜æ–¹é’±åŒ…...");
                // è°ƒç”¨ SDK å‘èµ·æ”¯ä»˜
                Pi.createPayment(paymentData, callbacks);
            } catch (err) {
                // æ­¤æ—¶åº”å¼¹å‡ºä½ ä¹‹å‰çœ‹åˆ°çš„ payments scope æŠ¥é”™è¯¦æƒ…
                alert("æ‹‰èµ·é’±åŒ…å¤±è´¥å…·ä½“åŸå› : " + err.message + " (ä»£ç : " + err.code + ")");
            }
        }

        // æœªå®Œæˆæ”¯ä»˜å¤„ç†å›è°ƒ (SDK è¦æ±‚)
        function onIncompletePaymentFound(payment) {
            console.log("å¤„ç†æœªå®Œæˆæ”¯ä»˜: ", payment);
        };
    </script>
</body>
</html>
